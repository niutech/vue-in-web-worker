{"version":3,"file":"worker.nodom.js","sources":["../../../output/worker-thread/strings.js","../../../output/worker-thread/phase.js","../../../output/worker-thread/nodes.js","../../../output/worker-thread/MutationTransfer.js","../../../output/worker-thread/amp/amp.js","../../../output/worker-thread/function.js","../../../output/worker-thread/dom/DocumentLite.js","../../../output/worker-thread/amp/delete-globals.js","../../../output/worker-thread/index.nodom.amp.js"],"sourcesContent":["/**\n * Copyright 2018 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nlet count = 0;\nlet transfer = [];\nconst mapping = new Map();\n/**\n * Stores a string in mapping and returns the index of the location.\n * @param value string to store\n * @return location in map\n */\nexport function store(value) {\n    if (mapping.has(value)) {\n        // Safe to cast since we verified the mapping contains the value\n        return mapping.get(value);\n    }\n    mapping.set(value, count);\n    transfer.push(value);\n    return count++;\n}\n/**\n * Retrieve the index for a string (mostly used for tests).\n * @param value string value we need to know the index of\n * @returns index in the map for the string\n */\nexport function getForTesting(value) {\n    return mapping.get(value);\n}\nexport function getForTestingPartial(value) {\n    const found = Array.from(mapping.keys()).find((str) => str.includes(value));\n    if (found) {\n        return mapping.get(found);\n    }\n}\n/**\n * Returns strings registered but not yet transferred.\n * Side effect: Resets the transfer array to default value, to prevent passing the same values multiple times.\n */\nexport function consume() {\n    const strings = transfer;\n    transfer = [];\n    return strings;\n}\n//# sourceMappingURL=strings.js.map","/**\n * Copyright 2018 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nexport let phase = 0 /* Initializing */;\nexport const set = (newPhase) => (phase = newPhase);\n//# sourceMappingURL=phase.js.map","/**\n * Copyright 2018 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { phase } from './phase';\nlet count = 0;\nlet transfer = [];\nconst mapping = new Map();\n/**\n * Override the store for a node during the initialization phase.\n * @param node Node to store and modify with index\n * @param override Override number to use as the identifier.\n *\n * NOTE: THIS IS ONLY TO BE USED DURING INITIALIZATION.\n */\nexport function storeOverride(node, override) {\n    if (phase === 0 /* Initializing */) {\n        mapping.set((node[7 /* index */] = override), node);\n        count = Math.max(count, override);\n    }\n    return override;\n}\n/**\n * Stores a node in mapping, and makes the index available on the Node directly.\n * @param node Node to store and modify with index\n * @return index Node was stored with in mapping\n */\nexport function store(node) {\n    if (node[7 /* index */] !== undefined) {\n        return node[7 /* index */];\n    }\n    mapping.set((node[7 /* index */] = ++count), node);\n    if (phase > 0 /* Initializing */) {\n        // After Initialization, include all future dom node creation into the list for next transfer.\n        transfer.push(node);\n    }\n    return count;\n}\n/**\n * Retrieves a node based on an index.\n * @param index location in map to retrieve a Node for\n * @return either the Node represented in index position, or null if not available.\n */\nexport function get(index) {\n    // mapping has a 1 based index, since on first store we ++count before storing.\n    return (!!index && mapping.get(index)) || null;\n}\n/**\n * Returns nodes registered but not yet transferred.\n * Side effect: Resets the transfer array to default value, to prevent passing the same values multiple times.\n */\nexport function consume() {\n    const copy = transfer;\n    transfer = [];\n    return copy;\n}\n//# sourceMappingURL=nodes.js.map","/**\n * Copyright 2018 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { consume as consumeNodes } from './nodes';\nimport { consume as consumeStrings } from './strings';\nimport { phase, set as setPhase } from './phase';\nlet pending = false;\nlet pendingMutations = [];\n// TODO(choumx): Change `mutation` to Array<Uint16> to prevent casting errors e.g. integer underflow, precision loss.\nexport function transfer(document, mutation) {\n    if (phase > 0 /* Initializing */ && document[58 /* allowTransfer */]) {\n        pending = true;\n        pendingMutations = pendingMutations.concat(mutation);\n        Promise.resolve().then((_) => {\n            if (pending) {\n                const nodes = new Uint16Array(consumeNodes().reduce((acc, node) => acc.concat(node[8 /* creationFormat */]), [])).buffer;\n                const mutations = new Uint16Array(pendingMutations).buffer;\n                document.postMessage({\n                    [54 /* phase */]: phase,\n                    [12 /* type */]: phase === 2 /* Mutating */ ? 3 /* MUTATE */ : 2 /* HYDRATE */,\n                    [37 /* nodes */]: nodes,\n                    [41 /* strings */]: consumeStrings(),\n                    [36 /* mutations */]: mutations,\n                }, [nodes, mutations]);\n                pendingMutations = [];\n                pending = false;\n                setPhase(2 /* Mutating */);\n            }\n        });\n    }\n}\n//# sourceMappingURL=MutationTransfer.js.map","/**\n * Copyright 2019 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { store } from '../strings';\nimport { transfer } from '../MutationTransfer';\nexport class AMP {\n    constructor(document) {\n        this.document = document;\n    }\n    /**\n     * Returns a promise that resolves with the value of `key`.\n     * @param key\n     */\n    getState(key) {\n        return new Promise((resolve) => {\n            const messageHandler = (event) => {\n                const message = event.data;\n                if (message[12 /* type */] !== 11 /* GET_STORAGE */) {\n                    return;\n                }\n                // TODO: There is a race condition here if there are multiple concurrent\n                // getState(k) messages in flight, where k is the same value.\n                const storageMessage = message;\n                if (storageMessage[74 /* storageKey */] !== key) {\n                    return;\n                }\n                this.document.removeGlobalEventListener('message', messageHandler);\n                const value = storageMessage[21 /* value */];\n                resolve(value);\n            };\n            this.document.addGlobalEventListener('message', messageHandler);\n            transfer(this.document, [12 /* STORAGE */, 1 /* GET */, 2 /* AmpState */, /* key */ store(key), /* value */ 0]);\n            setTimeout(resolve, 500, null); // TODO: Why a magical constant, define and explain.\n        });\n    }\n    /**\n     * Deep-merges `state` into the existing state.\n     * @param state\n     */\n    setState(state) {\n        // Stringify `state` so it can be post-messaged as a transferrable.\n        let stringified;\n        try {\n            stringified = JSON.stringify(state);\n        }\n        catch (e) {\n            throw new Error(`AMP.setState only accepts valid JSON as input.`);\n        }\n        transfer(this.document, [12 /* STORAGE */, 2 /* SET */, 2 /* AmpState */, /* key */ 0, /* value */ store(stringified)]);\n    }\n}\n//# sourceMappingURL=amp.js.map","/**\n * Copyright 2020 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { transfer } from './MutationTransfer';\nimport { store } from './strings';\nconst exportedFunctions = {};\nexport function callFunctionMessageHandler(event, document) {\n    const msg = event.data;\n    if (msg[12 /* type */] !== 12 /* FUNCTION */) {\n        return;\n    }\n    const functionMessage = msg;\n    const fnIdentifier = functionMessage[77 /* functionIdentifier */];\n    const fnArguments = JSON.parse(functionMessage[78 /* functionArguments */]);\n    const index = functionMessage[7 /* index */];\n    const fn = exportedFunctions[fnIdentifier];\n    if (!fn) {\n        transfer(document, [\n            13 /* FUNCTION_CALL */,\n            2 /* REJECT */,\n            index,\n            store(JSON.stringify(`[worker-dom]: Exported function \"${fnIdentifier}\" could not be found.`)),\n        ]);\n        return;\n    }\n    Promise.resolve(fn) // Forcing promise flows allows us to skip a try/catch block.\n        .then((f) => f.apply(null, fnArguments))\n        .then((value) => {\n        transfer(document, [13 /* FUNCTION_CALL */, 1 /* RESOLVE */, index, store(JSON.stringify(value))]);\n    }, (err) => {\n        const errorMessage = JSON.stringify(err.message || err);\n        transfer(document, [\n            13 /* FUNCTION_CALL */,\n            2 /* REJECT */,\n            index,\n            store(JSON.stringify(`[worker-dom]: Function \"${fnIdentifier}\" threw: \"${errorMessage}\"`)),\n        ]);\n    });\n}\nexport function exportFunction(name, fn) {\n    if (!name || name === '') {\n        throw new Error(`[worker-dom]: Attempt to export function was missing an identifier.`);\n    }\n    if (typeof fn !== 'function') {\n        throw new Error(`[worker-dom]: Attempt to export non-function failed: (\"${name}\", ${typeof fn}).`);\n    }\n    if (name in exportedFunctions) {\n        throw new Error(`[worker-dom]: Attempt to re-export function failed: \"${name}\".`);\n    }\n    exportedFunctions[name] = fn;\n}\nexport function resetForTesting() {\n    for (const key of Object.keys(exportedFunctions)) {\n        delete exportedFunctions[key];\n    }\n}\n//# sourceMappingURL=function.js.map","/**\n * Copyright 2020 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar _a, _b;\nimport { set as setPhase } from '../phase';\n/**\n * A lightweight Document stub for the no-dom amp binary.\n */\nexport class DocumentStub {\n    constructor() {\n        this[_a] = true;\n        this[_b] = -1;\n        this.defaultView = { document: this };\n    }\n    [(_a = 58 /* allowTransfer */, _b = 7 /* index */, 59 /* observe */)]() {\n        setPhase(2 /* Mutating */);\n    }\n}\n//# sourceMappingURL=DocumentLite.js.map","/**\n * Copyright 2020 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nconst ALLOWLISTED_GLOBALS = {\n    Array: true,\n    ArrayBuffer: true,\n    BigInt: true,\n    BigInt64Array: true,\n    BigUint64Array: true,\n    Boolean: true,\n    Cache: true,\n    CustomEvent: true,\n    DataView: true,\n    Date: true,\n    Error: true,\n    EvalError: true,\n    Event: true,\n    EventTarget: true,\n    Float32Array: true,\n    Float64Array: true,\n    Function: true,\n    Infinity: true,\n    Int16Array: true,\n    Int32Array: true,\n    Int8Array: true,\n    Intl: true,\n    JSON: true,\n    Map: true,\n    Math: true,\n    NaN: true,\n    Number: true,\n    Object: true,\n    Promise: true,\n    Proxy: true,\n    RangeError: true,\n    ReferenceError: true,\n    Reflect: true,\n    RegExp: true,\n    Set: true,\n    String: true,\n    Symbol: true,\n    SyntaxError: true,\n    TextDecoder: true,\n    TextEncoder: true,\n    TypeError: true,\n    URIError: true,\n    URL: true,\n    Uint16Array: true,\n    Uint32Array: true,\n    Uint8Array: true,\n    Uint8ClampedArray: true,\n    WeakMap: true,\n    WeakSet: true,\n    WebAssembly: true,\n    WebSocket: true,\n    XMLHttpRequest: true,\n    atob: true,\n    addEventListener: true,\n    removeEventListener: true,\n    btoa: true,\n    caches: true,\n    clearInterval: true,\n    clearTimeout: true,\n    console: true,\n    decodeURI: true,\n    decodeURIComponent: true,\n    document: true,\n    encodeURI: true,\n    encodeURIComponent: true,\n    escape: true,\n    fetch: true,\n    indexedDB: true,\n    isFinite: true,\n    isNaN: true,\n    location: true,\n    navigator: true,\n    onerror: true,\n    onrejectionhandled: true,\n    onunhandledrejection: true,\n    parseFloat: true,\n    parseInt: true,\n    performance: true,\n    requestAnimationFrame: true,\n    cancelAnimationFrame: true,\n    self: true,\n    setTimeout: true,\n    setInterval: true,\n    unescape: true,\n};\n// Modify global scope by removing disallowed properties.\nexport function deleteGlobals(global) {\n    /**\n     * @param object\n     * @param property\n     * @return True if property was deleted from object. Otherwise, false.\n     */\n    const deleteUnsafe = (object, property) => {\n        if (!ALLOWLISTED_GLOBALS.hasOwnProperty(property)) {\n            try {\n                delete object[property];\n                return true;\n            }\n            catch (e) { }\n        }\n        return false;\n    };\n    // Walk up global's prototype chain and dereference non-allowlisted properties\n    // until EventTarget is reached.\n    let current = global;\n    while (current && current.constructor !== EventTarget) {\n        const deleted = [];\n        const failedToDelete = [];\n        Object.getOwnPropertyNames(current).forEach((prop) => {\n            if (deleteUnsafe(current, prop)) {\n                deleted.push(prop);\n            }\n            else {\n                failedToDelete.push(prop);\n            }\n        });\n        console.info(`Removed ${deleted.length} references from`, current, ':', deleted);\n        if (failedToDelete.length) {\n            console.info(`Failed to remove ${failedToDelete.length} references from`, current, ':', failedToDelete);\n        }\n        current = Object.getPrototypeOf(current);\n    }\n}\n//# sourceMappingURL=delete-globals.js.map","/**\n * Copyright 2020 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { AMP } from './amp/amp';\nimport { callFunctionMessageHandler, exportFunction } from './function';\nimport { DocumentStub } from './dom/DocumentLite';\nimport { deleteGlobals } from './amp/delete-globals';\nconst noop = () => void 0;\nexport const workerDOM = (function (postMessage, addEventListener, removeEventListener) {\n    const document = new DocumentStub();\n    // TODO(choumx): Avoid polluting Document's public API.\n    document.postMessage = postMessage;\n    document.addGlobalEventListener = addEventListener;\n    document.removeGlobalEventListener = removeEventListener;\n    return { document };\n})(postMessage.bind(self) || noop, addEventListener.bind(self) || noop, removeEventListener.bind(self) || noop);\n// Modify global scope by removing disallowed properties.\ndeleteGlobals(self);\n// Offer APIs like AMP.setState() on the global scope.\nself.AMP = new AMP(workerDOM.document);\n// Allows for function invocation\nself.exportFunction = exportFunction;\naddEventListener('message', (evt) => callFunctionMessageHandler(evt, workerDOM.document));\nexport const hydrate = noop;\n//# sourceMappingURL=index.nodom.amp.js.map"],"names":["transfer","consume","consumeNodes","consumeStrings","setPhase"],"mappings":"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"}