{"version":3,"file":"worker.nodom.mjs","sources":["../../../output/worker-thread/strings.js","../../../output/worker-thread/phase.js","../../../output/worker-thread/nodes.js","../../../output/worker-thread/MutationTransfer.js","../../../output/worker-thread/amp/amp.js","../../../output/worker-thread/function.js","../../../output/worker-thread/dom/DocumentLite.js","../../../output/worker-thread/amp/delete-globals.js","../../../output/worker-thread/index.nodom.amp.js"],"sourcesContent":["/**\n * Copyright 2018 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nlet count = 0;\nlet transfer = [];\nconst mapping = new Map();\n/**\n * Stores a string in mapping and returns the index of the location.\n * @param value string to store\n * @return location in map\n */\nexport function store(value) {\n    if (mapping.has(value)) {\n        // Safe to cast since we verified the mapping contains the value\n        return mapping.get(value);\n    }\n    mapping.set(value, count);\n    transfer.push(value);\n    return count++;\n}\n/**\n * Retrieve the index for a string (mostly used for tests).\n * @param value string value we need to know the index of\n * @returns index in the map for the string\n */\nexport function getForTesting(value) {\n    return mapping.get(value);\n}\nexport function getForTestingPartial(value) {\n    const found = Array.from(mapping.keys()).find((str) => str.includes(value));\n    if (found) {\n        return mapping.get(found);\n    }\n}\n/**\n * Returns strings registered but not yet transferred.\n * Side effect: Resets the transfer array to default value, to prevent passing the same values multiple times.\n */\nexport function consume() {\n    const strings = transfer;\n    transfer = [];\n    return strings;\n}\n//# sourceMappingURL=strings.js.map","/**\n * Copyright 2018 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nexport let phase = 0 /* Initializing */;\nexport const set = (newPhase) => (phase = newPhase);\n//# sourceMappingURL=phase.js.map","/**\n * Copyright 2018 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { phase } from './phase';\nlet count = 0;\nlet transfer = [];\nconst mapping = new Map();\n/**\n * Override the store for a node during the initialization phase.\n * @param node Node to store and modify with index\n * @param override Override number to use as the identifier.\n *\n * NOTE: THIS IS ONLY TO BE USED DURING INITIALIZATION.\n */\nexport function storeOverride(node, override) {\n    if (phase === 0 /* Initializing */) {\n        mapping.set((node[7 /* index */] = override), node);\n        count = Math.max(count, override);\n    }\n    return override;\n}\n/**\n * Stores a node in mapping, and makes the index available on the Node directly.\n * @param node Node to store and modify with index\n * @return index Node was stored with in mapping\n */\nexport function store(node) {\n    if (node[7 /* index */] !== undefined) {\n        return node[7 /* index */];\n    }\n    mapping.set((node[7 /* index */] = ++count), node);\n    if (phase > 0 /* Initializing */) {\n        // After Initialization, include all future dom node creation into the list for next transfer.\n        transfer.push(node);\n    }\n    return count;\n}\n/**\n * Retrieves a node based on an index.\n * @param index location in map to retrieve a Node for\n * @return either the Node represented in index position, or null if not available.\n */\nexport function get(index) {\n    // mapping has a 1 based index, since on first store we ++count before storing.\n    return (!!index && mapping.get(index)) || null;\n}\n/**\n * Returns nodes registered but not yet transferred.\n * Side effect: Resets the transfer array to default value, to prevent passing the same values multiple times.\n */\nexport function consume() {\n    const copy = transfer;\n    transfer = [];\n    return copy;\n}\n//# sourceMappingURL=nodes.js.map","/**\n * Copyright 2018 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { consume as consumeNodes } from './nodes';\nimport { consume as consumeStrings } from './strings';\nimport { phase, set as setPhase } from './phase';\nlet pending = false;\nlet pendingMutations = [];\n// TODO(choumx): Change `mutation` to Array<Uint16> to prevent casting errors e.g. integer underflow, precision loss.\nexport function transfer(document, mutation) {\n    if (phase > 0 /* Initializing */ && document[58 /* allowTransfer */]) {\n        pending = true;\n        pendingMutations = pendingMutations.concat(mutation);\n        Promise.resolve().then((_) => {\n            if (pending) {\n                const nodes = new Uint16Array(consumeNodes().reduce((acc, node) => acc.concat(node[8 /* creationFormat */]), [])).buffer;\n                const mutations = new Uint16Array(pendingMutations).buffer;\n                document.postMessage({\n                    [54 /* phase */]: phase,\n                    [12 /* type */]: phase === 2 /* Mutating */ ? 3 /* MUTATE */ : 2 /* HYDRATE */,\n                    [37 /* nodes */]: nodes,\n                    [41 /* strings */]: consumeStrings(),\n                    [36 /* mutations */]: mutations,\n                }, [nodes, mutations]);\n                pendingMutations = [];\n                pending = false;\n                setPhase(2 /* Mutating */);\n            }\n        });\n    }\n}\n//# sourceMappingURL=MutationTransfer.js.map","/**\n * Copyright 2019 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { store } from '../strings';\nimport { transfer } from '../MutationTransfer';\nexport class AMP {\n    constructor(document) {\n        this.document = document;\n    }\n    /**\n     * Returns a promise that resolves with the value of `key`.\n     * @param key\n     */\n    getState(key) {\n        return new Promise((resolve) => {\n            const messageHandler = (event) => {\n                const message = event.data;\n                if (message[12 /* type */] !== 11 /* GET_STORAGE */) {\n                    return;\n                }\n                // TODO: There is a race condition here if there are multiple concurrent\n                // getState(k) messages in flight, where k is the same value.\n                const storageMessage = message;\n                if (storageMessage[74 /* storageKey */] !== key) {\n                    return;\n                }\n                this.document.removeGlobalEventListener('message', messageHandler);\n                const value = storageMessage[21 /* value */];\n                resolve(value);\n            };\n            this.document.addGlobalEventListener('message', messageHandler);\n            transfer(this.document, [12 /* STORAGE */, 1 /* GET */, 2 /* AmpState */, /* key */ store(key), /* value */ 0]);\n            setTimeout(resolve, 500, null); // TODO: Why a magical constant, define and explain.\n        });\n    }\n    /**\n     * Deep-merges `state` into the existing state.\n     * @param state\n     */\n    setState(state) {\n        // Stringify `state` so it can be post-messaged as a transferrable.\n        let stringified;\n        try {\n            stringified = JSON.stringify(state);\n        }\n        catch (e) {\n            throw new Error(`AMP.setState only accepts valid JSON as input.`);\n        }\n        transfer(this.document, [12 /* STORAGE */, 2 /* SET */, 2 /* AmpState */, /* key */ 0, /* value */ store(stringified)]);\n    }\n}\n//# sourceMappingURL=amp.js.map","/**\n * Copyright 2020 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { transfer } from './MutationTransfer';\nimport { store } from './strings';\nconst exportedFunctions = {};\nexport function callFunctionMessageHandler(event, document) {\n    const msg = event.data;\n    if (msg[12 /* type */] !== 12 /* FUNCTION */) {\n        return;\n    }\n    const functionMessage = msg;\n    const fnIdentifier = functionMessage[77 /* functionIdentifier */];\n    const fnArguments = JSON.parse(functionMessage[78 /* functionArguments */]);\n    const index = functionMessage[7 /* index */];\n    const fn = exportedFunctions[fnIdentifier];\n    if (!fn) {\n        transfer(document, [\n            13 /* FUNCTION_CALL */,\n            2 /* REJECT */,\n            index,\n            store(JSON.stringify(`[worker-dom]: Exported function \"${fnIdentifier}\" could not be found.`)),\n        ]);\n        return;\n    }\n    Promise.resolve(fn) // Forcing promise flows allows us to skip a try/catch block.\n        .then((f) => f.apply(null, fnArguments))\n        .then((value) => {\n        transfer(document, [13 /* FUNCTION_CALL */, 1 /* RESOLVE */, index, store(JSON.stringify(value))]);\n    }, (err) => {\n        const errorMessage = JSON.stringify(err.message || err);\n        transfer(document, [\n            13 /* FUNCTION_CALL */,\n            2 /* REJECT */,\n            index,\n            store(JSON.stringify(`[worker-dom]: Function \"${fnIdentifier}\" threw: \"${errorMessage}\"`)),\n        ]);\n    });\n}\nexport function exportFunction(name, fn) {\n    if (!name || name === '') {\n        throw new Error(`[worker-dom]: Attempt to export function was missing an identifier.`);\n    }\n    if (typeof fn !== 'function') {\n        throw new Error(`[worker-dom]: Attempt to export non-function failed: (\"${name}\", ${typeof fn}).`);\n    }\n    if (name in exportedFunctions) {\n        throw new Error(`[worker-dom]: Attempt to re-export function failed: \"${name}\".`);\n    }\n    exportedFunctions[name] = fn;\n}\nexport function resetForTesting() {\n    for (const key of Object.keys(exportedFunctions)) {\n        delete exportedFunctions[key];\n    }\n}\n//# sourceMappingURL=function.js.map","/**\n * Copyright 2020 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar _a, _b;\nimport { set as setPhase } from '../phase';\n/**\n * A lightweight Document stub for the no-dom amp binary.\n */\nexport class DocumentStub {\n    constructor() {\n        this[_a] = true;\n        this[_b] = -1;\n        this.defaultView = { document: this };\n    }\n    [(_a = 58 /* allowTransfer */, _b = 7 /* index */, 59 /* observe */)]() {\n        setPhase(2 /* Mutating */);\n    }\n}\n//# sourceMappingURL=DocumentLite.js.map","/**\n * Copyright 2020 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nconst ALLOWLISTED_GLOBALS = {\n    Array: true,\n    ArrayBuffer: true,\n    BigInt: true,\n    BigInt64Array: true,\n    BigUint64Array: true,\n    Boolean: true,\n    Cache: true,\n    CustomEvent: true,\n    DataView: true,\n    Date: true,\n    Error: true,\n    EvalError: true,\n    Event: true,\n    EventTarget: true,\n    Float32Array: true,\n    Float64Array: true,\n    Function: true,\n    Infinity: true,\n    Int16Array: true,\n    Int32Array: true,\n    Int8Array: true,\n    Intl: true,\n    JSON: true,\n    Map: true,\n    Math: true,\n    NaN: true,\n    Number: true,\n    Object: true,\n    Promise: true,\n    Proxy: true,\n    RangeError: true,\n    ReferenceError: true,\n    Reflect: true,\n    RegExp: true,\n    Set: true,\n    String: true,\n    Symbol: true,\n    SyntaxError: true,\n    TextDecoder: true,\n    TextEncoder: true,\n    TypeError: true,\n    URIError: true,\n    URL: true,\n    Uint16Array: true,\n    Uint32Array: true,\n    Uint8Array: true,\n    Uint8ClampedArray: true,\n    WeakMap: true,\n    WeakSet: true,\n    WebAssembly: true,\n    WebSocket: true,\n    XMLHttpRequest: true,\n    atob: true,\n    addEventListener: true,\n    removeEventListener: true,\n    btoa: true,\n    caches: true,\n    clearInterval: true,\n    clearTimeout: true,\n    console: true,\n    decodeURI: true,\n    decodeURIComponent: true,\n    document: true,\n    encodeURI: true,\n    encodeURIComponent: true,\n    escape: true,\n    fetch: true,\n    indexedDB: true,\n    isFinite: true,\n    isNaN: true,\n    location: true,\n    navigator: true,\n    onerror: true,\n    onrejectionhandled: true,\n    onunhandledrejection: true,\n    parseFloat: true,\n    parseInt: true,\n    performance: true,\n    requestAnimationFrame: true,\n    cancelAnimationFrame: true,\n    self: true,\n    setTimeout: true,\n    setInterval: true,\n    unescape: true,\n};\n// Modify global scope by removing disallowed properties.\nexport function deleteGlobals(global) {\n    /**\n     * @param object\n     * @param property\n     * @return True if property was deleted from object. Otherwise, false.\n     */\n    const deleteUnsafe = (object, property) => {\n        if (!ALLOWLISTED_GLOBALS.hasOwnProperty(property)) {\n            try {\n                delete object[property];\n                return true;\n            }\n            catch (e) { }\n        }\n        return false;\n    };\n    // Walk up global's prototype chain and dereference non-allowlisted properties\n    // until EventTarget is reached.\n    let current = global;\n    while (current && current.constructor !== EventTarget) {\n        const deleted = [];\n        const failedToDelete = [];\n        Object.getOwnPropertyNames(current).forEach((prop) => {\n            if (deleteUnsafe(current, prop)) {\n                deleted.push(prop);\n            }\n            else {\n                failedToDelete.push(prop);\n            }\n        });\n        console.info(`Removed ${deleted.length} references from`, current, ':', deleted);\n        if (failedToDelete.length) {\n            console.info(`Failed to remove ${failedToDelete.length} references from`, current, ':', failedToDelete);\n        }\n        current = Object.getPrototypeOf(current);\n    }\n}\n//# sourceMappingURL=delete-globals.js.map","/**\n * Copyright 2020 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { AMP } from './amp/amp';\nimport { callFunctionMessageHandler, exportFunction } from './function';\nimport { DocumentStub } from './dom/DocumentLite';\nimport { deleteGlobals } from './amp/delete-globals';\nconst noop = () => void 0;\nexport const workerDOM = (function (postMessage, addEventListener, removeEventListener) {\n    const document = new DocumentStub();\n    // TODO(choumx): Avoid polluting Document's public API.\n    document.postMessage = postMessage;\n    document.addGlobalEventListener = addEventListener;\n    document.removeGlobalEventListener = removeEventListener;\n    return { document };\n})(postMessage.bind(self) || noop, addEventListener.bind(self) || noop, removeEventListener.bind(self) || noop);\n// Modify global scope by removing disallowed properties.\ndeleteGlobals(self);\n// Offer APIs like AMP.setState() on the global scope.\nself.AMP = new AMP(workerDOM.document);\n// Allows for function invocation\nself.exportFunction = exportFunction;\naddEventListener('message', (evt) => callFunctionMessageHandler(evt, workerDOM.document));\nexport const hydrate = noop;\n//# sourceMappingURL=index.nodom.amp.js.map"],"names":["transfer","consume","consumeNodes","consumeStrings","setPhase"],"mappings":"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"}